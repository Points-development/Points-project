<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.huiyong.dao.UserMapper" >

  <resultMap id="BaseResultMap" type="com.huiyong.model.User" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="branch" property="branch" jdbcType="VARCHAR" />
    <result column="property" property="property" jdbcType="VARCHAR" />
    <result column="isAdmin" property="isAdmin" jdbcType="TINYINT" />
  </resultMap>
  <select id="getUserByName" parameterType="String" resultMap="BaseResultMap">
    select User.id, User.name, User.password, User.branch, UserProperty.name property, User.isAdmin from User join UserProperty on User.user_property_id=UserProperty.id
    	where User.name=#{name}
  </select>
   <select id="getPropertyId" parameterType="String" resultType="Integer">
    select id from UserProperty
    	where name=#{name}
  </select>
  <select id="getAllBranches" resultType="string">
    select distinct branch from User
  </select>
    <select id="getUsersInBranch" parameterType="String" resultMap="BaseResultMap">
    select User.id, User.name, User.password, User.branch, UserProperty.name property, User.isAdmin from User join UserProperty on User.user_property_id=UserProperty.id
    	where branch=#{branchname}
  </select>
  <select id="getAllProperties" resultType="String">
    select name from UserProperty where name !='共性'
  </select>
  <insert id="addUser" useGeneratedKeys="true">  
        INSERT INTO User (name,  
                          <if test="user.password != null" >
        					password,
      					  </if> 
                          <if test="user.branch != null" >
        					branch,
      					  </if>  
      					  user_property_id,
                          isAdmin)  
              VALUES   (#{user.name},
                          <if test="user.password != null" >
        					#{user.password},
      					  </if> 
                          <if test="user.branch != null" >
        					#{user.branch},
      					  </if> 
      					  #{propertyId},
                        #{user.isAdmin})      
  </insert>  
    <update id="updateUser" useGeneratedKeys="true">  
        UPDATE User SET  <if test="user.password != null" >
        				 User.password=#{user.password},
        				  </if> 
                          <if test="user.branch != null" >
        				 User.branch=#{user.branch},
      					  </if> 
                        User.isAdmin=#{user.isAdmin},
                        User.user_property_id=#{propertyId}
                        where User.name=#{user.name};
  </update>  
   <update id="deleteUser" parameterType="String" useGeneratedKeys="true">  
        DELETE FROM User where name=#{username};
  </update> 
 </mapper>