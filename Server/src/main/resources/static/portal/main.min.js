!function(){"use strict";angular.module("portal",["portal.core","portal.login","portal.layout","portal.system","portal.query"])}(),function(){"use strict";function e(e,t,r,n,o){e.determinePreferredLanguage().fallbackLanguage("en_US"),r.state("home",{url:"/home",templateUrl:"app/layout/layout.html",controller:"LayoutController",controllerAs:"lac"}).state("login",{url:"/login",templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"loginCtrl"}).state("resetpwd",{url:"/resetpwd",templateUrl:"app/login/resetpwd.html",controller:"LoginController",controllerAs:"loginCtrl"}).state("register",{url:"/register",templateUrl:"app/login/register.html",controller:"LoginController",controllerAs:"loginCtrl"}),t.otherwise("/login")}angular.module("portal").config(e),e.$inject=["$translateProvider","$urlRouterProvider","$stateProvider","$httpProvider","allPermissions"]}(),function(){"use strict";function e(e){e.listen()}angular.module("portal").run(e),e.$inject=["listener"]}(),function(){"use strict";angular.module("blocks.listener",[])}(),function(){"use strict";function e(e,t,r,n,o,s,a){function i(){t.$on("$stateChangeStart",function(e,t){"login"!==t.name&&!a.isAuthenticated()&&(o.go("login",{},{reload:!0}),e.preventDefault())}),t.$on("$stateChangeSuccess",function(e,t){var n=t.name.split("."),o=n.length>1?n[1]:n[0];r.addPart(o),"home"!==o&&r.addPart("home"),t.name})}return{listen:i}}angular.module("blocks.listener").factory("listener",e),e.$inject=["$log","$rootScope","$translatePartialLoader","$translate","$state","allPermissions","security"]}(),function(){"use strict";angular.module("blocks.security",[]).constant("allPermissions",{operations:{view:"VIEW",ctrl:"CONTROL",all:"ALL"},resources:{allLines:"ALL_TRAVEL_LINES",manageSystem:"SYSTEM_MANAGE",manageDestinationCity:"DESTINATION_CITY_MANAGE"}})}(),function(){"use strict";function e(e,t,r,n){function o(e,r,o){t.post("/pointservice/login",{name:e.username,password:e.password},{skipAuthorization:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(e){n.set("currentUser",e.data),e.data.admin?r():o({message:"user is not approved"})},function(e){o(e.data)})}function s(){return!(!n.get("currentUser")&&!n.getFromLocal("currentUser"))}function a(){return n.get("currentUser")||n.getFromLocal("currentUser")}function i(e){if(!e)return!1;var t=n.get("currentUser")||n.getFromLocal("currentUser");if(!t||r.isTokenExpired(t.token))return!1;for(var o=!1,s=0;s<t.authorities.length;s++)if(e.op+"_"+e.res==t.authorities[s].authority){o=!0;break}return o}function c(){n.cleanAll()}function l(e,r,n){t.put("/pointservice/user/"+e.name,e,{headers:{"Content-Type":"application/json"}}).then(function(e){r(e.data)},function(e){n(e)})}return{authenticate:o,isAuthenticated:s,getCurrentUser:a,hasPermission:i,changePwd:l,clean:c}}angular.module("blocks.security").factory("security",e),e.$inject=["$log","$http","jwtHelper","storage"]}(),function(){"use strict";angular.module("blocks.storage",[])}(),function(){"use strict";function e(e,t,r){function n(e,r){t[e]=r}function o(e,t){r[e]=t}function s(e){return t[e]}function a(e){return r[e]}function i(){t.$reset(),r.$reset()}function c(){t.$reset()}function l(){r.$reset()}return{set:n,setToLocal:o,get:s,getFromLocal:a,cleanAll:i,cleanSession:c,cleanLocal:l}}angular.module("blocks.storage").factory("storage",e),e.$inject=["$log","$sessionStorage","$localStorage"]}(),function(){"use strict";angular.module("portal.core",["angular-jwt","angular-loading-bar","MessageCenterModule","AngularPrint","blocks.listener","blocks.security","blocks.storage","ngStorage","pascalprecht.translate","ui.bootstrap","ui.router"]).config(["cfpLoadingBarProvider",function(e){e.includeSpinner=!1}]).directive("switch",function(){return{restrict:"AE",replace:!0,transclude:!0,template:function(e,t){var r="";return r+="<span",r+=' class="switch'+(t.class?" "+t.class:"")+'"',r+=t.ngModel?' ng-click="'+t.disabled+" ? "+t.ngModel+" : "+t.ngModel+"=!"+t.ngModel+(t.ngChange?"; "+t.ngChange+'()"':'"'):"",r+=' ng-class="{ checked:'+t.ngModel+", disabled:"+t.disabled+' }"',r+=">",r+="<small></small>",r+='<input type="checkbox"',r+=t.id?' id="'+t.id+'"':"",r+=t.name?' name="'+t.name+'"':"",r+=t.ngModel?' ng-model="'+t.ngModel+'"':"",r+=' style="display:none" />',r+='<span class="switch-text">',r+=t.on?'<span class="on">'+t.on+"</span>":"",r+=t.off?'<span class="off">'+t.off+"</span>":" ",r+="</span>"}}})}(),function(){"use strict";angular.module("portal.login",["portal.core"])}(),function(){"use strict";function e(e,t,r,n,o){var s={};return s.addUser=function(e){var t=r.defer();return n.post("/unrestricted/register",e,{skipAuthorization:!0,headers:{"Content-Type":"application/json"}}).then(function(e){t.resolve(e.data)},function(e){t.reject(angular.fromJson(e.data))}),t.promise},s}angular.module("portal.login").factory("loginService",e),e.$inject=["$log","$filter","$q","$http","security"]}(),function(){"use strict";function e(e,t,r,n,o){function s(){a.username&&a.password?r.authenticate(a,i,c):a.failedByUser=!0}var a=this;a.login=s;var i=function(){e.go("home.system",{},{reload:!0})},c=function(e){e.message?e.message.indexOf("verify code")>0?a.failedByVerify=!0:e.message.indexOf("not approved")>0?a.failedByRefuse=!0:a.failedByUser=!0:a.failedByUser=!0};a.removeWran=function(e){"code"==e?a.failedByVerify=!1:a.failedByUser=!1}}angular.module("portal.login").controller("LoginController",e),e.$inject=["$state","$uibModal","security","loginService","storage"]}(),function(){"use strict";angular.module("portal.layout",["portal.core"]).directive("autoheight",["$window",function(e){return{restrict:"A",scope:{},link:function(t,r,n){var o=e.innerHeight-55;r.css("height",o+"px"),r.css("overflow-y","auto")}}}])}(),function(){"use strict";function e(e,t){e.state("home.system",{url:"/system_user",templateUrl:"app/system/user/user.html",controller:"UserManageController",controllerAs:"umCtrl"}).state("home.query",{url:"/query_user",templateUrl:"app/query/query.html",controller:"QueryController",controllerAs:"qcCtrl"})}angular.module("portal.layout").config(e),e.$inject=["$stateProvider","allPermissions"]}(),function(){"use strict";function e(e,t,r,n,o,s){var a=this;a.refresh=function(){t.go(t.current,{},{reload:!0})},a.logout=function(){s.cleanSession(),a.currentUser=null,t.go("login")};var i=t.current.name.split(/\./);a.activeNode=i[0]+"."+i[1],a.currentUser=n.getCurrentUser(),a.systemManage=!0,a.queryNode=!1,"home.system"==a.activeNode?a.systemManage=!0:"home.query"==a.activeNode&&(a.queryNode=!0),a.viewMode="nav-md",a.switchViewMode=function(){"nav-md"==a.viewMode?a.viewMode="nav-sm":a.viewMode="nav-md"},a.activeTreeNode=function(e){a.activeNode=e,"home.system"==e?a.systemManage=!a.systemManage:"home.query"==e&&(a.queryNode=!a.queryNode),t.go(e,{},{reload:!0})},a.changePwd=function(){o.open({animation:!0,ariaLabelledBy:"modal-title-top",ariaDescribedBy:"modal-body-top",templateUrl:"pwdModel.html",controller:["$scope","$uibModalInstance","security",function(e,t,r){e.change_error="",e.change_success="",e.changepwd_ok=function(){if(""!=e.change_success&&t.close(),e.newpwd!=e.newpwd2)return e.change_error="新密码两次输入不一致",!1;a.currentUser.password=e.newpwd,r.changePwd(a.currentUser,function(t){e.change_error="",e.change_success="密码更新成功"},function(t){e.change_error="修改失败"})},e.changepwd_cancel=function(){t.dismiss("cancel")}}]})}}angular.module("portal.layout").controller("LayoutController",e),e.$inject=["$log","$state","allPermissions","security","$uibModal","storage"]}(),function(){"use strict";angular.module("portal.system",["system.user"])}(),function(){"use strict";function e(e,t){var r={};return r.getUsers=function(r){var n=t.defer();return e.get("/pointservice/branch?branch="+encodeURIComponent(r)).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}),n.promise},r.getUsersProperty=function(){var r=t.defer();return e.get("/pointservice/user/property").then(function(e){r.resolve(e.data)},function(e){r.reject(e.data)}),r.promise},r.createUser=function(r){var n=t.defer();return e.post("/pointservice/user",r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}),n.promise},r.updateUser=function(r){var n=t.defer();return e.put("/pointservice/user/"+r.name,r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}),n.promise},r.deleteUser=function(r){var n=t.defer();return e.delete("/pointservice/user/"+r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}),n.promise},r.getUsersScore=function(r){var n=t.defer();return e.get("/pointservice/score/points?branch="+r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}),n.promise},r}angular.module("portal.system").factory("systemService",e),e.$inject=["$http","$q"]}(),function(){"use strict";angular.module("system.user",["portal.core"])}(),function(){"use strict";function e(e,t,r,n,o){var s=this;s.selectUser=null,s.currentUser=o.getCurrentUser(),s.init=function(){s.hasSelected=0,r.getUsers(s.currentUser.branch).then(function(e){s.userlist=e},function(e){t.add("danger","数据请求失败!",{timeout:3e3})}),r.getUsersProperty().then(function(e){s.userPropertys=e},function(e){t.add("danger","数据请求失败!",{timeout:3e3})})},s.queryUser=function(){r.getUsers(s.queryBranch).then(function(e){s.userlist=e},function(e){t.add("danger","数据请求失败!",{timeout:3e3})}),r.getUsersProperty().then(function(e){s.userPropertys=e},function(e){t.add("danger","数据请求失败!",{timeout:3e3})})},s.selectCheck=function(e){s.selectUser=e},s.addUser=function(){n.open({animation:!0,size:"cm-user",ariaLabelledBy:"modal-title-top",ariaDescribedBy:"modal-body-top",templateUrl:"templates/userModel.html",controller:["$scope","$uibModalInstance",function(e,n){e.error="",e.user={property:""},e.admin=!1,e.userPropertys=s.userPropertys,e.submit_user=function(){if(!e.name||!e.branch||!e.user.property)return e.error="所有选项必填",!1;var o={name:e.name,branch:e.branch,property:e.user.property,admin:e.admin};r.createUser(o).then(function(e){t.add("success","创建成功!",{timeout:3e3}),s.init(),n.dismiss("cancel")},function(e){t.add("danger",e,{timeout:3e3})})},e.cancel=function(){n.dismiss("cancel")}}]})},s.updateUser=function(){n.open({animation:!0,size:"cm-user",ariaLabelledBy:"modal-title-top",ariaDescribedBy:"modal-body-top",templateUrl:"templates/userUpdateModel.html",controller:["$scope","$uibModalInstance",function(e,n){e.error="",e.user=s.selectUser,e.userPropertys=s.userPropertys,e.resetPwd=!1,e.submit_user=function(){if(!e.user.branch)return e.error="支部选项必填",!1;e.resetPwd?e.user.password="123456":delete e.user.password,r.updateUser(e.user).then(function(e){t.add("success","更新成功!",{timeout:3e3}),s.init(),n.dismiss("cancel")},function(e){t.add("danger",e,{timeout:3e3})})},e.cancel=function(){n.dismiss("cancel")}}]})},s.scrollTableStyle={width:"100%",height:window.innerHeight-270,"overflow-y":"scroll","margin-top":"-40px"}}angular.module("system.user").controller("UserManageController",e),e.$inject=["storage","messageCenterService","systemService","$uibModal","security"]}(),function(){"use strict";angular.module("portal.query",["query.user"])}(),function(){"use strict";angular.module("query.user",["portal.core"])}(),function(){"use strict";function e(e,t,r,n){var o=this,s=n.getCurrentUser();o.userName=s.name,o.branch=s.branch,o.queryObject=null,o.resultlist=[],o.startQuery=function(e){o.resultlist=[],r.getUsersScore(e).then(function(e){o.resultlist=e},function(e){e.error?t.add("danger",e.error,{timeout:3e3}):t.add("danger","数据请求失败!",{timeout:3e3})})},o.scrollTableStyle={width:"100%",height:window.innerHeight-270,"overflow-y":"scroll","margin-top":"-40px"},o.getScore=function(e){return e.selfPoint+e.otherPoint},o.printdiv=function(){window.print()}}angular.module("query.user").controller("QueryController",e),e.$inject=["storage","messageCenterService","systemService","security"]}();
//# sourceMappingURL=main.min.js.map
